# Redmine Pivot Plugin

Redmineのチケットをピボットテーブル形式で表示・集計するプラグインです。
[Pivottable.js](https://pivottable.js.org/) を使用しており、ブラウザ上で直感的にクロス集計を行うことができます。

## 機能

- **チケットのクロス集計**: 標準フィールド（ステータス、優先度、担当者など）およびカスタムフィールドを行・列に自由に配置して集計できます。
- **ドラッグ＆ドロップ操作**: フィールドをマウス操作で移動させるだけで、集計軸を動的に変更できます。
- **パフォーマンス最適化**: 大量のチケットがある場合でも、カスタムフィールドの一括読み込み（Eager Loading）により高速にデータを取得します。
- **カスタムクエリ対応**: 保存済みのカスタムクエリを選択して、集計対象のチケットを絞り込むことができます。

## インストール方法

1. Redmineの `plugins` ディレクトリに本プラグインを配置します。
   （ディレクトリ名は `redmine_pivot` としてください）
   ```bash
   cd /path/to/redmine/plugins
   git clone https://your-repository-url/redmine_pivot.git
   ```

2. Redmineを再起動します。

## 利用方法

### 1. モジュールの有効化
プラグインを使用したいプロジェクトの「設定」画面を開き、「モジュール」タブを選択します。
モジュール一覧の中にある **「Pivot（または ピボット）」** にチェックを入れ、「保存」をクリックします。
※ デフォルトでは有効になっている場合もあります。

### 2. ピボットテーブルの表示
プロジェクトメニュー（「概要」「チケット」などが並んでいる列）に追加された **「ピボット」** タブをクリックします。
チケットデータが読み込まれ、ピボットテーブルが表示されます。

### 3. チケットの絞り込み（カスタムクエリ）
画面右側のサイドバーに、保存済みの「カスタムクエリ」一覧が表示されます。
任意のクエリをクリックすると、そのクエリ条件に合致するチケットのみが集計対象として読み込まれます。
「すべてのチケット」をクリックすると、絞り込みが解除されます。

### 4. 集計の設定（Aggregators）
画面左上のプルダウンメニュー（初期値「件数」）から、集計方法（アグリゲーター）を変更できます。

| 集計方法 | 説明 | 利用シーン |
| :--- | :--- | :--- |
| **件数** | チケットの個数をカウントします（デフォルト）。 | ステータスごとのチケット数を知りたい場合など。 |
| **合計** | 指定した数値フィールドの値を合計します。 | 「予定工数」の合計や、数値型カスタムフィールド（例: 売上、コスト）の総和を求めたい場合。 |
| **平均** | 指定した数値フィールドの平均を算出します。 | チケットごとの平均工数などを分析する場合。 |
| **件数に対する割合** | 全体、行、列に対する割合（％）を表示します。 | 特定のトラッカーが全体の何割を占めるか等を見る場合。 |

**数値フィールドの選択方法**:
「合計」や「平均」を選択すると、その隣に新たなプルダウンメニューが表示されます。ここで集計対象としたい数値フィールド（例: `estimated_hours` や `数値リスト`）を選択してください。

### 5. 軸の操作
画面上部には利用可能なフィールド（ステータス、トラッカー、カスタムフィールド等）が並んでいます。

- **行の追加**: フィールドを行エリア（左側）にドラッグ＆ドロップします。
- **列の追加**: フィールドを列エリア（上部）にドラッグ＆ドロップします。
- **フィルタリング**: 各フィールド名の右側にある「▼」をクリックすると、表示する値を絞り込むことができます（例: 「終了」ステータスを除外する）。

### 6. グラフ表示
表形式だけでなく、棒グラフや円グラフなどで表示することも可能です。左上のプルダウンメニュー（通常「表」となっている箇所）からチャートの種類を選択してください。
